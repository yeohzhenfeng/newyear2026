<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Happy New Year</title>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
}
canvas{
  position:absolute;
  inset:0;
}
#bg{ z-index:1; }
#ui{ z-index:2; }
</style>
</head>

<body>
<canvas id="bg"></canvas>
<canvas id="ui"></canvas>

<script>
/* ===============================
   基础 canvas（高清）
================================ */
function fit(cvs,ctx){
  const dpr = Math.min(3,window.devicePixelRatio||1);
  const r = cvs.getBoundingClientRect();
  cvs.width = r.width*dpr;
  cvs.height = r.height*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return {w:r.width,h:r.height};
}

const bg = bg.getContext ? bg : document.getElementById('bg');
const ui = ui.getContext ? ui : document.getElementById('ui');
const bgCtx = bg.getContext('2d');
const uiCtx = ui.getContext('2d');

let W=0,H=0;

/* ===============================
   背景：简单烟花（不抢字）
================================ */
let sparks=[];
function spawnFirework(){
  const x=Math.random()*W;
  const y=Math.random()*H*0.4;
  for(let i=0;i<40;i++){
    const a=Math.random()*Math.PI*2;
    sparks.push({
      x,y,
      vx:Math.cos(a)*(1+Math.random()*2),
      vy:Math.sin(a)*(1+Math.random()*2),
      life:60
    });
  }
}

function drawBG(){
  bgCtx.fillStyle='rgba(0,0,0,0.25)';
  bgCtx.fillRect(0,0,W,H);

  if(Math.random()<0.03) spawnFirework();

  for(let i=sparks.length-1;i>=0;i--){
    const s=sparks[i];
    s.x+=s.vx;
    s.y+=s.vy;
    s.vy+=0.02;
    s.life--;

    bgCtx.fillStyle=`rgba(255,200,120,${s.life/60})`;
    bgCtx.beginPath();
    bgCtx.arc(s.x,s.y,2,0,Math.PI*2);
    bgCtx.fill();

    if(s.life<=0) sparks.splice(i,1);
  }
}

/* ===============================
   UI 文本（关键：清晰）
================================ */
const font =
'-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",Arial,sans-serif';

let currentText = '';
let mode = 'text'; // text | love
let timer = 0;
let countdown = 5;

function drawText(){
  uiCtx.clearRect(0,0,W,H);

  uiCtx.textAlign='center';
  uiCtx.textBaseline='middle';

  if(mode==='countdown'){
    uiCtx.font='900 120px '+font;
    uiCtx.fillStyle='#fff';
    uiCtx.fillText(countdown,W/2,H/2);
    return;
  }

  if(mode==='text'){
    uiCtx.font='800 56px '+font;
    uiCtx.shadowColor='rgba(255,255,255,.6)';
    uiCtx.shadowBlur=18;
    uiCtx.fillStyle='#fff';
    uiCtx.fillText(currentText,W/2,H/2);
    return;
  }

  if(mode==='love'){
    // 男
    uiCtx.fillStyle='#fff';
    uiCtx.beginPath();
    uiCtx.arc(W/2-160,H/2-40,24,0,Math.PI*2);
    uiCtx.fill();
    uiCtx.fillRect(W/2-184,H/2-16,48,80);

    // 女
    uiCtx.beginPath();
    uiCtx.arc(W/2-80,H/2-40,24,0,Math.PI*2);
    uiCtx.fill();
    uiCtx.beginPath();
    uiCtx.moveTo(W/2-104,H/2+16);
    uiCtx.lineTo(W/2-56,H/2+16);
    uiCtx.lineTo(W/2-80,H/2+120);
    uiCtx.closePath();
    uiCtx.fill();

    // LOVE
    uiCtx.font='900 88px '+font;
    uiCtx.shadowBlur=22;
    uiCtx.fillText('LOVE',W/2+120,H/2+40);
  }
}

/* ===============================
   时间线控制（稳定）
================================ */
const steps = [
  {type:'countdown', time:1000},
  {type:'text', text:'HAPPY NEW YEAR', time:2500},
  {type:'text', text:'Little Fairy', time:2000},
  {type:'text', text:'May your hard work pay off', time:2600},
  {type:'text', text:'Focus. Believe. Achieve.', time:2600},
  {type:'love', time:999999}
];

let stepIndex=0;

function nextStep(){
  const s=steps[stepIndex];
  mode=s.type;
  timer=0;

  if(s.type==='countdown') countdown=5;
  if(s.type==='text') currentText=s.text;

  stepIndex=Math.min(stepIndex+1,steps.length-1);
}

/* ===============================
   主循环
================================ */
let last=0;
function loop(t){
  const dt=t-last; last=t;
  drawBG();
  drawText();

  const s=steps[stepIndex-1];
  if(!s) return requestAnimationFrame(loop);

  timer+=dt;

  if(s.type==='countdown' && timer>1000){
    countdown--;
    timer=0;
    if(countdown<=0) nextStep();
  }

  if(s.type!=='countdown' && timer>s.time){
    nextStep();
  }

  requestAnimationFrame(loop);
}

/* ===============================
   启动
================================ */
function resize(){
  const a=fit(bg,bgCtx);
  const b=fit(ui,uiCtx);
  W=a.w; H=a.h;
}
window.addEventListener('resize',resize);
resize();
nextStep();
requestAnimationFrame(loop);
</script>
</body>
</html>
